<% include ../partials/Header %>

<body>
	<div class="wrapper">
		<% include ../partials/RightBar %>

		<div class="main">
			<% include ../partials/SearchBar %>

			<main class="content">
				<% if(locals.message){ %>
				<div class="alert alert-success" role="alert">
					<strong>Well done!</strong> <%=message.success%>
				</div>
				<% } %>
				<!--Form Account-->
				<div class="col-md-12">
					<div class="card">
						<div class="card-header">
							<h2 class="card-title">Thêm loại sản phẩm</h2>
							<!-- <h6 class="card-subtitle text-muted">Thêm tài khoản</h6> -->
						</div>
						<div class="card-body">
							<% if(mgs!= "") { %>
							<li> <%=mgs%></li>
							<%}%>
								<!-- <form id="proTypeForm" action="/productType/addType" method="POST" enctype="multipart/form-data"> -->
								<form id="proTypeForm" enctype="multipart/form-data">
								<div class="form-group">
									<label class="form-label">Tên loại</label>
									<input type="text" name="typeName" class="form-control" placeholder="Tên loại sản phẩm">
								</div>
								<div class="form-group">
									<label class="form-label">Mô tả</label>
									<textarea class="form-control" name="description" placeholder="Mô tả loại sản phẩm"
										rows="3"></textarea>
								</div>
								<div class="form-group">
									<label class="form-label w-100">Ảnh loại</label>
									<input name="typeImg" id="typeImg" type="file" onchange="loadImg(event)"
										accept="image/png, image/jpeg">
									<small class="form-text text-muted">
										<img name="typeImgForm" id="typeImgForm" src="#" height="200px" width="200px" alt="No IMG">
									</small>
								</div>
								<div class="form-group">
									<label class="custom-control custom-checkbox">
									</label>
								</div>
								<button id="btnSubmit" onclick="addType(event)" name="btnCreate" class="btn btn-primary">Thêm loại sản phẩm</button>
							</form>
						</div>
					</div>
				</div>
				<!--ListAccount-->
				<div class="col-12 col-xl-12">
					<div class="card">
						<div class="card-header">
							<h5 class="card-title">Danh sách loại sản phẩm</h5>
							<h6 class="card-subtitle text-muted">Loại sản phẩm</h6>
						</div>
						<table class="table">
							<thead>
								<tr>
									<th style="width:20%;">Tên loại sản phẩm</th>
									<th style="width:20%">Mô tả</th>
									<th style="width:20%">Hình ảnh</th>
									<th>Tuỳ chỉnh</th>
								</tr>
							</thead>
							<tbody>
								<% for (var i = 0; i < listProductType.length; i++) { %>
							<tr>
								<td><%= listProductType[i].typeName %></td>
								<td><%= listProductType[i].description %></td>
								<td>
									<img src="<%= listProductType[i].typeImg %>" class="avatar img-fluid" alt="No IMG">
								</td>
								<td class="table-action">
									<button type="button" name="btn_edit"><i class="align-middle" data-feather="edit-2"></i></button>
									<button type="button" name="btn_delete"><i class="align-middle" data-feather="trash"></i></button>
								</td>
							</tr>
							<% } %>

							</tbody>
							</table>
						</div>
					</div>
			</main>
			<% include ../partials/Footer %>
		</div>
	</div>
	<script type="text/javascript">
		var addType =function (event) {
			event.preventDefault();
			var formData = new FormData();

			var typeName = $('[name=typeName]').val();
			var des = $('[name=description]').val();
			var file = $('[name=typeImg]').get(0).files;

			formData.append('imgType', file[0]);
			formData.append('typeName', typeName);
			formData.append('description', des);

			$.ajax({
				url: 'productType/addType',
				type: 'POST',
				data: formData,
				cache: false,
				contentType: false,
				processData: false,
			}).done(function (result) {
				if (result.success) {
					alert(result.mgs)
					location.reload()
				} else {
					alert(result.mgs)
				}
			}).fail(() => {
				alert("Không kết nối được với server")
			})
		}
		var editType =function (event) {
			event.preventDefault();
			var formData = new FormData();

			var typeName = $('[name=typeName]').val();
			var des = $('[name=description]').val();
			var file = $('[name=typeImg]').get(0).files;

			formData.append('imgType', file[0]);
			formData.append('typeName', typeName);
			formData.append('description', des);

			$.ajax({
				url: 'productType/editType',
				type: 'POST',
				data: formData,
				cache: false,
				contentType: false,
				processData: false,
			}).done(function (result) {
				if (result.success) {
					alert(result.mgs)
					location.reload()
				} else {
					alert(result.mgs)
				}
			}).fail(() => {
				alert("Không kết nối được với server")
			})
		}
		var loadImg = function (event) {
			$('#typeImgForm').attr('src', URL.createObjectURL(event.target.files[0]));
		};
		
		$('[name=btn_edit]').click(function () {
			var name = ($(this).parent().parent().children().eq(0).html());
			var des = ($(this).parent().parent().children().eq(1).html());
			var img = ($(this).parent().parent().children().eq(2).children().eq(0).attr("src"));
			$('#typeImgForm').attr('src', img);
			$('[name=typeName]').val(name);
			$('[name=description]').val(des);
			$('[name=typeImgForm]').attr('src', img);
			$('[name=btnCreate]').html('Cập nhật');
			$('[name=btnCreate]').attr('name', 'btnUpdate');
			$("#btnSubmit").attr("onclick","editType(event)");
		});
	</script>
	<script src="js/app.js"></script>
</body>

</html>